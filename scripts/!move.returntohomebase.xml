<?xml version="1.0" standalone="yes" ?>
<?xml-stylesheet href="x2script.xsl" type="text/xsl" ?>
<script>
<name>!move.returntohomebase</name>
<version>5</version>
<engineversion>73</engineversion>
<description>return to home base</description>
<arguments>
</arguments>
<sourceplaintext>
<![CDATA[
  while [TRUE]
    $homebase = [HOMEBASE]
    
    skip if $homebase -> exists
      return FLRET_INVALIDPARMS
    
    if [THIS] -> is of class Drone
      if not $homebase -> is of class Ship
        if [THIS] -> is of class Freight Drone
          skip if $homebase -> is docking possible of [THIS]
            return FLRET_INVALIDPARMS
        else
          return FLRET_INVALIDPARMS
        end
      end
    else if not $homebase -> is docking possible of [THIS]
      return FLRET_INVALIDPARMS
    end
    
    [THIS] ->set destination to $homebase
    
    while $homebase == [HOMEBASE]
      skip if $homebase -> exists
        goto label exit
      
      if not [THIS] -> is in same sector as $homebase
        $sec = $homebase -> get sector
@       $ret = [THIS] -> call script !move.movetosector :  sector=$sec
        if $ret == FLRET_NOPATH
          [THIS] ->set destination to null
          return $ret
        end
@       = wait randomly from 100 to 200 ms
        continue
      end
      
      do if [DOCKEDAT] == $homebase
        goto label exit
      
      if [THIS] -> is docked
@       = [THIS] -> call script !move.undock : 
@       = wait randomly from 100 to 200 ms
        continue
      end
      
      if [THIS] -> is docking allowed at $homebase
@       $ret = [THIS] -> call script !move.movetostation :  station=$homebase
        if $ret == FLRET_NOCARGO
          [THIS] ->set destination to null
          return $ret
        end
      else
@       = [THIS] -> move around 60000 ms
      end
@     = wait randomly from 100 to 200 ms
    end
  end
  
  exit:
  [THIS] ->set destination to null
  return FLRET_OK
]]>
</sourceplaintext>
<sourcetext>
<line indent=""><var>while&#160;</var><var>[TRUE]</var></line>
<line indent="&#160;"><var>$homebase&#160;=&#160;</var><var>[HOMEBASE]</var></line>
<line indent="&#160;"></line>
<line indent="&#160;"><var>skip&#160;if&#160;</var><var>$homebase&#160;-&gt;</var><text>&#160;exists</text></line>
<line indent="&#160;&#160;"><text>return&#160;</text><var>FLRET_INVALIDPARMS</var></line>
<line indent="&#160;"></line>
<line indent="&#160;"><var>if&#160;</var><var>[THIS]&#160;-&gt;</var><text>&#160;is&#160;of&#160;class&#160;</text><var>Drone</var></line>
<line indent="&#160;&#160;"><var>if&#160;not&#160;</var><var>$homebase&#160;-&gt;</var><text>&#160;is&#160;of&#160;class&#160;</text><var>Ship</var></line>
<line indent="&#160;&#160;&#160;"><var>if&#160;</var><var>[THIS]&#160;-&gt;</var><text>&#160;is&#160;of&#160;class&#160;</text><var>Freight&#160;Drone</var></line>
<line indent="&#160;&#160;&#160;&#160;"><var>skip&#160;if&#160;</var><var>$homebase&#160;-&gt;</var><text>&#160;is&#160;docking&#160;possible&#160;of&#160;</text><var>[THIS]</var></line>
<line indent="&#160;&#160;&#160;&#160;&#160;"><text>return&#160;</text><var>FLRET_INVALIDPARMS</var></line>
<line indent="&#160;&#160;&#160;"><text>else</text></line>
<line indent="&#160;&#160;&#160;&#160;"><text>return&#160;</text><var>FLRET_INVALIDPARMS</var></line>
<line indent="&#160;&#160;&#160;"><text>end</text></line>
<line indent="&#160;&#160;"><text>end</text></line>
<line indent="&#160;"><var>else&#160;if&#160;not&#160;</var><var>$homebase&#160;-&gt;</var><text>&#160;is&#160;docking&#160;possible&#160;of&#160;</text><var>[THIS]</var></line>
<line indent="&#160;&#160;"><text>return&#160;</text><var>FLRET_INVALIDPARMS</var></line>
<line indent="&#160;"><text>end</text></line>
<line indent="&#160;"></line>
<line indent="&#160;"><var>[THIS]&#160;-&gt;</var><text>set&#160;destination&#160;to&#160;</text><var>$homebase</var></line>
<line indent="&#160;"></line>
<line indent="&#160;"><var>while&#160;</var><var>$homebase</var><text>&#160;</text><var>==</var><text>&#160;</text><var>[HOMEBASE]</var></line>
<line indent="&#160;&#160;"><var>skip&#160;if&#160;</var><var>$homebase&#160;-&gt;</var><text>&#160;exists</text></line>
<line indent="&#160;&#160;&#160;"><text>goto&#160;label&#160;</text><var>exit</var></line>
<line indent="&#160;&#160;"></line>
<line indent="&#160;&#160;"><var>if&#160;not&#160;</var><var>[THIS]&#160;-&gt;</var><text>&#160;is&#160;in&#160;same&#160;sector&#160;as&#160;</text><var>$homebase</var></line>
<line indent="&#160;&#160;&#160;"><var>$sec&#160;=&#160;</var><var>$homebase&#160;-&gt;</var><text>&#160;get&#160;sector</text></line>
<line interruptable="@" indent="&#160;&#160;&#160;"><var>$ret&#160;=&#160;</var><var>[THIS]&#160;-&gt;</var><text>&#160;call&#160;script&#160;</text><call>!move.movetosector</call><text>&#160;:&#160;</text><text>&#160;sector=</text><var>$sec</var></line>
<line indent="&#160;&#160;&#160;"><var>if&#160;</var><var>$ret</var><text>&#160;</text><var>==</var><text>&#160;</text><var>FLRET_NOPATH</var></line>
<line indent="&#160;&#160;&#160;&#160;"><var>[THIS]&#160;-&gt;</var><text>set&#160;destination&#160;to&#160;</text><var>null</var></line>
<line indent="&#160;&#160;&#160;&#160;"><text>return&#160;</text><var>$ret</var></line>
<line indent="&#160;&#160;&#160;"><text>end</text></line>
<line interruptable="@" indent="&#160;&#160;&#160;"><var>=&#160;</var><text>wait&#160;randomly&#160;from&#160;</text><var>100</var><text>&#160;to&#160;</text><var>200</var><text>&#160;ms</text></line>
<line indent="&#160;&#160;&#160;"><text>continue</text></line>
<line indent="&#160;&#160;"><text>end</text></line>
<line indent="&#160;&#160;"></line>
<line indent="&#160;&#160;"><var>do&#160;if&#160;</var><var>[DOCKEDAT]</var><text>&#160;</text><var>==</var><text>&#160;</text><var>$homebase</var></line>
<line indent="&#160;&#160;&#160;"><text>goto&#160;label&#160;</text><var>exit</var></line>
<line indent="&#160;&#160;"></line>
<line indent="&#160;&#160;"><var>if&#160;</var><var>[THIS]&#160;-&gt;</var><text>&#160;is&#160;docked</text></line>
<line interruptable="@" indent="&#160;&#160;&#160;"><var>=&#160;</var><var>[THIS]&#160;-&gt;</var><text>&#160;call&#160;script&#160;</text><call>!move.undock</call><text>&#160;:&#160;</text></line>
<line interruptable="@" indent="&#160;&#160;&#160;"><var>=&#160;</var><text>wait&#160;randomly&#160;from&#160;</text><var>100</var><text>&#160;to&#160;</text><var>200</var><text>&#160;ms</text></line>
<line indent="&#160;&#160;&#160;"><text>continue</text></line>
<line indent="&#160;&#160;"><text>end</text></line>
<line indent="&#160;&#160;"></line>
<line indent="&#160;&#160;"><var>if&#160;</var><var>[THIS]&#160;-&gt;</var><text>&#160;is&#160;docking&#160;allowed&#160;at&#160;</text><var>$homebase</var></line>
<line interruptable="@" indent="&#160;&#160;&#160;"><var>$ret&#160;=&#160;</var><var>[THIS]&#160;-&gt;</var><text>&#160;call&#160;script&#160;</text><call>!move.movetostation</call><text>&#160;:&#160;</text><text>&#160;station=</text><var>$homebase</var></line>
<line indent="&#160;&#160;&#160;"><var>if&#160;</var><var>$ret</var><text>&#160;</text><var>==</var><text>&#160;</text><var>FLRET_NOCARGO</var></line>
<line indent="&#160;&#160;&#160;&#160;"><var>[THIS]&#160;-&gt;</var><text>set&#160;destination&#160;to&#160;</text><var>null</var></line>
<line indent="&#160;&#160;&#160;&#160;"><text>return&#160;</text><var>$ret</var></line>
<line indent="&#160;&#160;&#160;"><text>end</text></line>
<line indent="&#160;&#160;"><text>else</text></line>
<line interruptable="@" indent="&#160;&#160;&#160;"><var>=&#160;</var><var>[THIS]&#160;-&gt;</var><text>&#160;move&#160;around&#160;</text><var>60000</var><text>&#160;ms</text></line>
<line indent="&#160;&#160;"><text>end</text></line>
<line interruptable="@" indent="&#160;&#160;"><var>=&#160;</var><text>wait&#160;randomly&#160;from&#160;</text><var>100</var><text>&#160;to&#160;</text><var>200</var><text>&#160;ms</text></line>
<line indent="&#160;"><text>end</text></line>
<line indent=""><text>end</text></line>
<line indent=""></line>
<line indent=""><var>exit</var><text>:</text></line>
<line indent=""><var>[THIS]&#160;-&gt;</var><text>set&#160;destination&#160;to&#160;</text><var>null</var></line>
<line indent=""><text>return&#160;</text><var>FLRET_OK</var></line>
</sourcetext>
<codearray>

<sval type="array" size="10">
  <sval type="string" val="!move.returntohomebase"/>
  <sval type="int" val="73"/>
  <sval type="string" val="return to home base"/>
  <sval type="int" val="5"/>
  <sval type="int" val="0"/>
  <sval type="array" size="3">
    <sval type="string" val="homebase"/>
    <sval type="string" val="sec"/>
    <sval type="string" val="ret"/>
  </sval>
  <sval type="array" size="45">
    <sval type="array" size="7">
      <sval type="int" val="104"/>
      <sval type="int" val="-1610601975"/>
      <sval type="int" val="1"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="10"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-1"/>
    </sval>
    <sval type="array" size="7">
      <sval type="int" val="104"/>
      <sval type="int" val="0"/>
      <sval type="int" val="1"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="4"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-1"/>
    </sval>
    <sval type="array" size="4">
      <sval type="int" val="706"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
      <sval type="int" val="-536869881"/>
    </sval>
    <sval type="array" size="3">
      <sval type="int" val="103"/>
      <sval type="int" val="19"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="6">
      <sval type="int" val="705"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-1610609661"/>
      <sval type="int" val="12"/>
      <sval type="int" val="2061"/>
    </sval>
    <sval type="array" size="6">
      <sval type="int" val="705"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
      <sval type="int" val="-536868092"/>
      <sval type="int" val="12"/>
      <sval type="int" val="2004"/>
    </sval>
    <sval type="array" size="6">
      <sval type="int" val="705"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-1610610173"/>
      <sval type="int" val="12"/>
      <sval type="int" val="2092"/>
    </sval>
    <sval type="array" size="6">
      <sval type="int" val="746"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
      <sval type="int" val="-536868601"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
    </sval>
    <sval type="array" size="3">
      <sval type="int" val="103"/>
      <sval type="int" val="19"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="112"/>
      <sval type="int" val="11"/>
    </sval>
    <sval type="array" size="3">
      <sval type="int" val="103"/>
      <sval type="int" val="19"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="112"/>
      <sval type="int" val="14"/>
    </sval>
    <sval type="array" size="6">
      <sval type="int" val="746"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
      <sval type="int" val="-536867322"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
    </sval>
    <sval type="array" size="3">
      <sval type="int" val="103"/>
      <sval type="int" val="19"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="5">
      <sval type="int" val="519"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="13">
      <sval type="int" val="104"/>
      <sval type="int" val="-1610602231"/>
      <sval type="int" val="3"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="4"/>
      <sval type="int" val="15"/>
      <sval type="int" val="0"/>
      <sval type="int" val="3"/>
      <sval type="int" val="-1"/>
      <sval type="int" val="0"/>
      <sval type="int" val="-2"/>
    </sval>
    <sval type="array" size="4">
      <sval type="int" val="706"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
      <sval type="int" val="-536866297"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="100"/>
      <sval type="int" val="42"/>
    </sval>
    <sval type="array" size="6">
      <sval type="int" val="733"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-536864252"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="4">
      <sval type="int" val="703"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
      <sval type="int" val="1"/>
    </sval>
    <sval type="array" size="8">
      <sval type="int" val="102"/>
      <sval type="string" val="!move.movetosector"/>
      <sval type="int" val="2"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="1"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="1"/>
    </sval>
    <sval type="array" size="13">
      <sval type="int" val="104"/>
      <sval type="int" val="-1610606589"/>
      <sval type="int" val="3"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="2"/>
      <sval type="int" val="19"/>
      <sval type="int" val="13"/>
      <sval type="int" val="15"/>
      <sval type="int" val="0"/>
      <sval type="int" val="3"/>
      <sval type="int" val="-1"/>
      <sval type="int" val="0"/>
      <sval type="int" val="-2"/>
    </sval>
    <sval type="array" size="5">
      <sval type="int" val="519"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="3">
      <sval type="int" val="103"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="6">
      <sval type="int" val="107"/>
      <sval type="int" val="-2147483647"/>
      <sval type="int" val="4"/>
      <sval type="int" val="100"/>
      <sval type="int" val="4"/>
      <sval type="int" val="200"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="112"/>
      <sval type="int" val="15"/>
    </sval>
    <sval type="array" size="13">
      <sval type="int" val="104"/>
      <sval type="int" val="-1610605560"/>
      <sval type="int" val="3"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="11"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
      <sval type="int" val="15"/>
      <sval type="int" val="0"/>
      <sval type="int" val="3"/>
      <sval type="int" val="-1"/>
      <sval type="int" val="0"/>
      <sval type="int" val="-2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="100"/>
      <sval type="int" val="42"/>
    </sval>
    <sval type="array" size="4">
      <sval type="int" val="745"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-1610604541"/>
    </sval>
    <sval type="array" size="6">
      <sval type="int" val="102"/>
      <sval type="string" val="!move.undock"/>
      <sval type="int" val="-2147483647"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="6">
      <sval type="int" val="107"/>
      <sval type="int" val="-2147483647"/>
      <sval type="int" val="4"/>
      <sval type="int" val="100"/>
      <sval type="int" val="4"/>
      <sval type="int" val="200"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="112"/>
      <sval type="int" val="15"/>
    </sval>
    <sval type="array" size="6">
      <sval type="int" val="513"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-1610603005"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="8">
      <sval type="int" val="102"/>
      <sval type="string" val="!move.movetostation"/>
      <sval type="int" val="2"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="1"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="13">
      <sval type="int" val="104"/>
      <sval type="int" val="-1610603261"/>
      <sval type="int" val="3"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="2"/>
      <sval type="int" val="19"/>
      <sval type="int" val="15"/>
      <sval type="int" val="15"/>
      <sval type="int" val="0"/>
      <sval type="int" val="3"/>
      <sval type="int" val="-1"/>
      <sval type="int" val="0"/>
      <sval type="int" val="-2"/>
    </sval>
    <sval type="array" size="5">
      <sval type="int" val="519"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="3">
      <sval type="int" val="103"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="112"/>
      <sval type="int" val="39"/>
    </sval>
    <sval type="array" size="6">
      <sval type="int" val="507"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-2147483647"/>
      <sval type="int" val="4"/>
      <sval type="int" val="60000"/>
    </sval>
    <sval type="array" size="6">
      <sval type="int" val="107"/>
      <sval type="int" val="-2147483647"/>
      <sval type="int" val="4"/>
      <sval type="int" val="100"/>
      <sval type="int" val="4"/>
      <sval type="int" val="200"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="112"/>
      <sval type="int" val="15"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="112"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="101"/>
      <sval type="string" val="exit"/>
    </sval>
    <sval type="array" size="5">
      <sval type="int" val="519"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="3">
      <sval type="int" val="103"/>
      <sval type="int" val="19"/>
      <sval type="int" val="14"/>
    </sval>
  </sval>
  <sval type="int" val="0"/>
  <sval type="array" size="23">
    <sval type="array" size="2">
      <sval type="int" val="2"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="4"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="10"/>
      <sval type="int" val="5"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="11"/>
      <sval type="int" val="4"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="11"/>
      <sval type="int" val="4"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="14"/>
      <sval type="int" val="4"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="14"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="15"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="18"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="24"/>
      <sval type="int" val="4"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="26"/>
      <sval type="int" val="6"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="26"/>
      <sval type="int" val="4"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="26"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="28"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="32"/>
      <sval type="int" val="6"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="32"/>
      <sval type="int" val="4"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="32"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="37"/>
      <sval type="int" val="4"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="38"/>
      <sval type="int" val="5"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="39"/>
      <sval type="int" val="4"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="41"/>
      <sval type="int" val="4"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="42"/>
      <sval type="int" val="4"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="42"/>
      <sval type="int" val="2"/>
    </sval>
  </sval>
  <sval type="int" val="0"/>
</sval>

</codearray>
<nosignature>5636</nosignature>
</script>
